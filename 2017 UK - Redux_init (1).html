campaignTrail_temp.election_json = JSON.parse("[{\"model\": \"campaign_trail.election\", \"pk\": 20, \"fields\": {\"year\": 2017, \"summary\": \"<div style='overflow-y:scroll;height:200px;'><p> A year ago, the unprecedented happened. The world was shook on the 23rd of June 2016 when the United Kingdom voted to leave the European Union, the first time that a country had voted to do such a thing. In the wake of the results, Prime Minister David Cameron resigned the Premiership, setting up a Conservative leadership election that would determine who would carry the country forwards into the negotiations with the EU. Theresa May ultimately would end up winning this leadership election, giving her the keys to 10 Downing Street to lead the country into its next tumultuous chapter. </p><p>Unfortunately for her however, her thin majority from Cameron’s 2015 victory splinters away, putting her in a situation where certain factions of the Conservative Party begin to obstruct. Stonewalled by a disunited party, but at the same time being gifted a massive lead in the polls, there doesn’t seem like any better time to call a snap election to grow her majority than right now.</p><p>It’s 2017. The Conservatives start in a very strong position, 20 points ahead of Labour, which has been languishing in its own even more intense disunity under their dark horse leader Jeremy Corbyn. With this being the case, a massive increase in her majority seems all but inevitable for the Tories.</p><p>Theresa May may have campaigned to Remain in 2016, but nevertheless, the party chose her over her closest rival for leadership, the Leave-voting Andrea Leadsom. All she has to do is keep her lead. That can’t be too hard in this political environment, right?</p><p>Jeremy Corbyn is an interesting figure in his own right. After the resignation of Ed Miliband after losing the 2015 general election, the party’s membership nominated the 100-1 odds choice through their own new democratic selection system established by the previous leader, Ed Milband. This marked a dramatic shift from the Third Way centrist leanings of New Labour, now Labour has returned with an aggressive pivot back to its hard-left and socialist legacy. Corbyn may be low in the polls, but he has a secret weapon that Theresa May and the Conservatives don’t have, an extremely vibrant grassroots supporter base. Could this be what carries him from relative obscurity only 2 years ago all the way into Number 10?</p><p>It must hurt to see what was such a prosperous third political option be reduced to merely a single-digit number of seats in 2015. Deputy Prime Minister Nick Clegg had all but failed his own party, his voters furious about a myriad of issues that the party betrayed. Clegg resigned in shame, only for the party’s next leader Tim Farron left to pick up the pieces, and figure out what he can do to resuscitate a party that has been so thoroughly annihilated by his predecessor. </p>\", \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/Intro.jpeg\", \"winning_electoral_vote_number\": 326, \"advisor_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/AdvisersMay.png\", \"recommended_reading\": \"<div style=\\\"overflow-y:scroll;height:357.133px;font-size:1em;\\\"><h3 style='margin-top: 0.5em;'>Learn More about the 2017 UK General Election</h3><h4 style='margin-top: 0.5em;'>2017 General Election Party Manifestos</h4><a href='https://s3.eu-west-2.amazonaws.com/conservative-party-manifestos/Forward+Together+-+Our+Plan+for+a+Stronger+Britain+and+a+More+Prosperous....pdf'>Forward, Together: Our Plan for a Stronger Britain and a More Prosperous Future, Conservative Party </a><br><a href='https://labour.org.uk/wp-content/uploads/2017/10/labour-manifesto-2017.pdf'>For the Many, Not the Few, Labour Party</a><br><a href='https://d3n8a8pro7vhmx.cloudfront.net/themes/5909d4366ad575794c000000/attachments/original/1495020157/Manifesto-Final.pdf?1495020157'>Change Britain's Future, Liberal Democrats</a><br><a href='https://d3n8a8pro7vhmx.cloudfront.net/ukipdev/pages/3944/attachments/original/1495695469/UKIP_Manifesto_June2017opt.pdf?1495695469'>Britain Together, UKIP</a><br><a href='https://www.greenparty.org.uk/assets/files/gp2017/greenguaranteepdf.pdf'>The Green Party for a Confident and Caring Britain, Green Party of England and Wales</a><br><a href='https://d3n8a8pro7vhmx.cloudfront.net/thesnp/pages/9544/attachments/original/1496320559/Manifesto_06_01_17.pdf?1496320559'>Stronger for Scotland, SNP</a><br><a href='https://manifesto.deryn.co.uk/wp-content/uploads/2021/04/Plaid_Cymru_-_Defending_Wales_-_2017_Action_Plan.pdf'>Tarian Cymru (Defending Wales): 2017 Action Plan, Plaid Cymru</a><h4>Extra Information</h4><a href='https://researchbriefings.files.parliament.uk/documents/CBP-7979/CBP-7979.pdf'>House of Commons Library: Results and Analysis</a><br>\", \"has_visits\": 0, \"no_electoral_majority_image\": \"https://assets-learning.parliament.uk/uploads/2020/05/HOC-Chamber-940x720.jpg\", \"site_description\":\"<p>A year ago, the unprecedented happened. The world was shook on the 23rd of June 2016 when the United Kingdom voted to leave the European Union, the first time that a country had voted to do such a thing. In the wake of the results, Prime Minister David Cameron resigned the Premiership, setting up a Conservative leadership election that would determine who would carry the country forwards into the negotiations with the EU. Theresa May ultimately would end up winning this leadership election, giving her the keys to 10 Downing Street to lead the country into its next tumultuous chapter.</p><p>Unfortunately for her however, her thin majority from Cameron’s 2015 victory splinters away, putting her in a situation where certain factions of the Conservative Party begin to obstruct. Stonewalled by a disunited party, but at the same time being gifted a massive lead in the polls, there doesn’t seem like any better time to call a snap election to grow her majority than right now.</p><p>It’s 2017. The Conservatives start in a very strong position, 20 points ahead of Labour, which has been languishing in its own even more intense disunity under their dark horse leader Jeremy Corbyn. With this being the case, a massive increase in her majority seems all but inevitable for the Tories.</p><p>Theresa May may have campaigned to Remain in 2016, but nevertheless, the party chose her over her closest rival for leadership, the Leave-voting Andrea Leadsom. All she has to do is keep her lead. That can’t be too hard in this political environment, right?</p><p>Jeremy Corbyn is an interesting figure in his own right. After the resignation of Ed Miliband after losing the 2015 general election, the party’s membership nominated the 100-1 odds choice through their own new democratic selection system established by the previous leader, Ed Milband. This marked a dramatic shift from the Third Way centrist leanings of New Labour, now Labour has returned with an aggressive pivot back to its hard-left and socialist legacy. Corbyn may be low in the polls, but he has a secret weapon that Theresa May and the Conservatives don’t have, an extremely vibrant grassroots supporter base. Could this be what carries him from relative obscurity only 2 years ago all the way into Number 10?</p><p>It must hurt to see what was such a prosperous third political option be reduced to merely a single-digit number of seats in 2015. Deputy Prime Minister Nick Clegg had all but failed his own party, his voters furious about a myriad of issues that the party betrayed. Clegg resigned in shame, only for the party’s next leader Tim Farron left to pick up the pieces, and figure out what he can do to resuscitate a party that has been so thoroughly annihilated by his predecessor. \"}}]");

campaignTrail_temp.candidate_json = JSON.parse("[{\"model\": \"campaign_trail.candidate\", \"pk\": 200, \"fields\": {\"first_name\": \"Boris Johnson -\", \"last_name\": \"Conservatives\", \"election\": 20, \"party\": \"Conservatives\", \"state\": \"Uxbrige and South Ruislip\", \"priority\": 1, \"description\": \"<p>After the fairly narrow win for the Leave campaign in 2016, David Cameron resigned the Premiership and Theresa May became the frontrunner to become the next Conservative Leader and Prime Minister as a unifying compromise candidate. She may have voted Remain in the 2016 referendum, but she was also Home Secretary for David Cameron, and in this role orchestrated the Hostile Environment policy, one of the strongest anti-immigration laws in the country’s history. Aside from this, she is rather close to a blank slate, who could direct her Premiership in many plausible directions. Theresa May’s biggest advantage is her unusually high versatility for a Conservative candidate and Prime Minister, but on the other hand, she has a reputation for lacking charisma, something that could become an obstacle for her. </p>\", \"color_hex\": \"#0087DC\", \"secondary_color_hex\": \"#0087DC\", \"is_active\": 1, \"image_url\": \"https://file.garden/Z5ZdT2XMBSWGuJym/JOHNSON\", \"electoral_victory_message\": \"<h3>Conservative Majority in government!</h3><p> It was the expected result, the Conservatives win the election with a majority in Parliament. It will depend on how large this majority is for what they’ll be able to do with it however. A slim majority may just put the party back where it was before, however if you succeeded at drastically increasing the Conservative majority, then give yourself a pat on the back. Britain will now go more comfortably into the Brexit negotiations and you will have a much more loyal and faithful party behind you.</p>\", \"electoral_loss_message\": \"<h3>How did you blow this?</h3><p>The Conservative party were riding high into this election, called the election to increase their majority, and ended up losing? Journalists are asking how an election campaign that started so high and mighty flop this poorly? All you had to do was maintain your poll numbers and carry the party forwards with an increased majority into the Brexit negotiations, and you couldn’t even do that? Labour now have a majority in Parliament, and will be forming a government. They will carry the country into the Brexit negotiations, and you, Theresa, will be remembered in the history books as one of the worst campaigners in history.</p>\", \"no_electoral_majority_message\": \"<h3>Well, this snap election backfired….</h3><p>No candidate secured a majority in Parliament. Depending on the number of seats each party has won, you may be able to form a government in a coalition or a minority government where you gain temporary support from one of the other parties. If you’re close enough, you may be able to form a coalition with the DUP in Northern Ireland, but in a situation like that prepare to hear a lot about Northern Irish issues because they’ll demand some concessions with Brexit. Otherwise it may be a coalition with the Liberal Democrats again, and they will really pressure the Brexit negotiations towards a softer form of Brexit. If you can’t form a government, then Labour will be forming a coalition with either the SNP, and a certain second Scottish referendum on the table, or the Liberal Democrats, to form a government.</p>\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 201, \"fields\": {\"first_name\": \"Jeremy Corbyn -\", \"last_name\": \"Labour\", \"election\": 20, \"party\": \"Labour\", \"state\": \"Islington North\", \"priority\": 2, \"description\": \"<p>It’s both a new and old chapter for the Labour party under their dark horse leader Jeremy Corbyn. Defying the odds in 2015, winning the Labour leadership election with 100-1 odds stacked up against him, even winning an outright majority in the first round.  Tired of the moderate incremental leadership from Miliband that lost the 2015 election, the Labour Party moved back hard to their left-wing traditional roots. Membership of the Labour party is skyrocketing to all new heights, whilst Corbyn’s poll numbers dwindle under his growing unpopularity with the wider electorate. Now facing down a 20 point deficit in the polls, can Corbyn turn this race around in a mere short 6 weeks to deny May her majority, or who knows, even win this election? With his eclectic charisma and legions of dedicated supporters, perhaps there is a way even though it doesn’t appear like there is? </p>\", \"color_hex\": \"#DC241f\", \"secondary_color_hex\": \"#6687F4\", \"is_active\": 1, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/CandidateCorbyn.png\", \"electoral_victory_message\": \"<h3>Nobody saw this coming!</h3><p>Labour have just won a majority in Parliament, against all expectations going into the campaign. Whatever you did out there, it was a miracle. Labour now are in position to form their government and lead the country into the Brexit negotiations, and repeal the austerity policies of the Conservative Party in the last 7 years. Depending on the size of this victory, you might be able to get more or less of your manifesto promises enacted into law, however, if this is a narrower victory, then expect opposition from some of the more extreme factions of the Labour Party. </p>\", \"electoral_loss_message\": \"<h3>It was to be expected.</h3><p>The polls suggested from the beginning that the Conservatives were going to win this election, that’s why they called it in the first place. If their majority is slim, the factionalism in the Conservative party may be severe enough for Labour or the other parties to have some say, however if the Conservatives won a solid majority, then you’ll firmly be in opposition through the Brexit negotiations. Hopefully the Conservatives will be able to get a good deal for the country.</p>\", \"no_electoral_majority_message\": \"<h3>Labour force a hung parliament!</h3><p>No candidate secured a majority in Parliament. This creates many possibilities. If the Conservatives came very close to 326 seats, they can form an agreement with the Northern Irish DUP, a conservative unionist party. If this is not possible, they may form a coalition with the Liberal Democrats again. The Liberal Democrats will force the Conservatives to moderate their Brexit deal to be softer, keeping Britain tied closer to Europe than the Conservatives wanted. If Labour is the largest party, they may form a coalition with the SNP. They are a left wing party in Scotland, but will demand a second Scottish referendum to back a Labour government, Or they could form a coalition with the Liberal Democrats, who would dampen Labour’s economic positions, pushing them rightwards. </p>\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 23, \"fields\": {\"first_name\": \"Tim Farron -\", \"last_name\": \"Liberal Democrats\", \"election\": 20, \"party\": \"Liberal Democrats\", \"state\": \"Westmorland and Lonsdale\", \"priority\": 3, \"description\": \"<b><p>Not yet playable</p></b><p>It really has been from hero to zero for the Liberal Democrats as a party, and Tim Farron is the one left picking up the pieces off the floor after Nick Clegg ran the party into the ground during the 2010-2015 coalition government. After the Lib Dems flopped horribly in 2015, down to only 8 seats, Clegg resigned and Farron is now leading the party. There’s no doubt that the party’s direction at the moment isn’t working, and Tim Farron is the one who’s tasked to breathe new life into the Lib Dems. Now the question is how to do this? Does he focus on taking a decisive stand on the issue of Brexit, or does he direct the effort more to social issues or other economic issues? Tim however has made some controversial statements in the past on the issues of his religious beliefs about homosexuality, which could crop up in the campaign and hurt him with voters that lean in a more progressive direction.</p>\", \"color_hex\": \"#FAA61A\", \"secondary_color_hex\": \"#FAA61A\", \"is_active\": 1, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/CandidateFarron.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 203, \"fields\": {\"first_name\": \"Paul Nuttall -\", \"last_name\": \"UKIP\", \"election\": 20, \"party\": \"UKIP\", \"state\": \"Westminster\", \"priority\": 4, \"description\": \"'\", \"color_hex\": \"#70147A\", \"secondary_color_hex\": \"#70147A\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/CandidateNuttall.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 165, \"fields\": {\"first_name\": \"Caroline Lucas and Johnathan Bartley -\", \"last_name\": \"Green\", \"election\": 20, \"party\": \"Green\", \"state\": \"Westminster\", \"priority\": 5, \"description\": \"'\", \"color_hex\": \"#6AB023\", \"secondary_color_hex\": \"#6AB023\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/CandidateLucasBartley.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 166, \"fields\": {\"first_name\": \"Nicola Sturgeon -\", \"last_name\": \"SNP\", \"election\": 20, \"party\": \"SNP\", \"state\": \"Scotland\", \"priority\": 6, \"description\": \"'\", \"color_hex\": \"#FFFF00\", \"secondary_color_hex\": \"#b3e5fc\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 167, \"fields\": {\"first_name\": \"Leanne Wood -\", \"last_name\": \"Plaid Cymru\", \"election\": 20, \"party\": \"Plaid Cymru\", \"state\": \"Wales\", \"priority\": 7, \"description\": \"'\", \"color_hex\": \"#008240\", \"secondary_color_hex\": \"#008240\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 168, \"fields\": {\"first_name\": \"Arlene Foster -\", \"last_name\": \"DUP\", \"election\": 20, \"party\": \"DUP\", \"state\": \"Northern Ireland\", \"priority\": 8, \"description\": \"'\", \"color_hex\": \"#D46A4C\", \"secondary_color_hex\": \"#D46A4C\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 169, \"fields\": {\"first_name\": \"Gerry Adams -\", \"last_name\": \"Sinn Féin\", \"election\": 20, \"party\": \"Sinn Féin\", \"state\": \"Northern Ireland\", \"priority\": 9, \"description\": \"'\", \"color_hex\": \"#008800\", \"secondary_color_hex\": \"#008800\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 170, \"fields\": {\"first_name\": \"Robin Swann -\", \"last_name\": \"UUP\", \"election\": 20, \"party\": \"UUP\", \"state\": \"Northern Ireland\", \"priority\": 10, \"description\": \"'\", \"color_hex\": \"#9999FF\", \"secondary_color_hex\": \"#9999FF\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 171, \"fields\": {\"first_name\": \"Colum Eastwood -\", \"last_name\": \"SDLP\", \"election\": 20, \"party\": \"SDLP\", \"state\": \"Northern Ireland\", \"priority\": 11, \"description\": \"'\", \"color_hex\": \"#99FF66\", \"secondary_color_hex\": \"#99FF66\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 172, \"fields\": {\"first_name\": \"Naomi Long -\", \"last_name\": \"Alliance\", \"election\": 20, \"party\": \"Alliance\", \"state\": \"Northern Ireland\", \"priority\": 12, \"description\": \"'\", \"color_hex\": \"#F6CB2F\", \"secondary_color_hex\": \"#F6CB2F\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 173, \"fields\": {\"first_name\": \"John Bercow -\", \"last_name\": \"Speaker\", \"election\": 20, \"party\": \"Speaker\", \"state\": \"Buckingham\", \"priority\": 13, \"description\": \"'\", \"color_hex\": \"#E0E0E0\", \"secondary_color_hex\": \"#E0E0E0\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 174, \"fields\": {\"first_name\": \".\", \"last_name\": \"Independent\", \"election\": 20, \"party\": \"Independent\", \"state\": \"North Down\", \"priority\": 13, \"description\": \"'\", \"color_hex\": \"#888888\", \"secondary_color_hex\": \"#888888\", \"is_active\": 0, \"image_url\": \"'\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"'\", \"candidate_score\": 1.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 204, \"fields\": {\"first_name\": \"\", \"last_name\": \"Mainstream Conservative\", \"election\": 20, \"party\": \"Conservative\", \"state\": \"Westminster\", \"priority\": 20, \"description\": \"'\", \"color_hex\": \"#0087DC\", \"secondary_color_hex\": \"#0087DC\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineMainstreamConservative.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>Your career after receiving the keys to Number 10 Downing Street has been rather unremarkable and undefined. This is a blessing and a curse for you. It’s a blessing as you haven’t peeved off any of the factions of the Conservative party, but it’s also a curse in that you haven’t yet done anything of note and thus the enthusiasm to vote for you in an upcoming election isn’t very high. There might be an unlikely advantage to running as a vague generic Conservative candidate however, with who your main opponent is. If you are as inoffensive and uncontroversial as possible, you might be able to sweep up moderate voters who aren’t interested in voting for the hard-left Labour candidate this time around without alienating a significant amount of voters in the fringes of the party.</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 205, \"fields\": {\"first_name\": \"\", \"last_name\": \"One-Nation Conservative\", \"election\": 20, \"party\": \"Conservatives\", \"state\": \"Westminster\", \"priority\": 15, \"description\": \"'\", \"color_hex\": \"#FF0000\", \"secondary_color_hex\": \"#FFA0A0\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineOneNationConservative.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>Upon receiving the keys to 10 Downing Street, you said in your first conference that you’re a One Nation Conservative, and you’ve made a point to stand by this image. Your predecessor too, identified as a one-nation Conservative. This could just be a buzzword, as it doesn’t point to any concrete policy positions, but also it could mark a move more towards moderate Conservative politics, something that can help you with voters turned off by Corbyn, and as well help the Scottish Conservatives. One-Nation Conservatism is associated with Conservative Prime Minister Benjamin Disraeli who emphasised this brand of “compassionate Conservatism”. What it will help less with is assuaging the fears of the hard Brexit flank of the party, a vocal minority that will likely become an obstacle if you don’t throw a bone their way every so often. Despite the moderate policies, the One-Nation Conservatives are perceived as upper class statespeople, so you still have that image issue to overcome.</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 207, \"fields\": {\"first_name\": \"\", \"last_name\": \"Hard Brexiteer\", \"election\": 20, \"party\": \"Conservatives\", \"state\": \"Westminster\", \"priority\": 16, \"description\": \"'\", \"color_hex\": \"#FF0000\", \"secondary_color_hex\": \"#FFA0A0\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineHardBrexiteerConservative.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>You’ve been noticed for your pivot since 2016. You may have voted to Remain, yet your campaign marks one that is centred on this crucial issue and you’ve been noticed for the strong takes you’ve made in relation to the EU. Of course, this pivot is understandable, as you are in unprecedented times that you now face down with grit and determination. It is expected that your campaign could shake the map up quite a bit. You could be on track to make massive gains in the so-called “Red Wall”, but at the same time, your hold over Southern Remain-voting constituencies could come under fire by the Liberal Democrats. It’s shaping up to be an election where you’ve got a lot to balance. However, for every vote you gain in the Brexit Red Wall heartlands, you’ll probably lose another in Scotland, which voted overwhelmingly to remain in the EU.</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 206, \"fields\": {\"first_name\": \"\", \"last_name\": \"Thatcherite Conservative\", \"election\": 20, \"party\": \"Conservatives\", \"state\": \"Westminster\", \"priority\": 12, \"description\": \"'\", \"color_hex\": \"#FF0000\", \"secondary_color_hex\": \"#FFA0A0\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineThatcheriteConservative.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>Look at you, Mrs. Prime Minister, what previous Prime Minister do you most resemble, and who could you potentially base this campaign off in an effective manner? That’s right, none other than the Iron Lady herself. And as a parallel, who does your Labour opponent most resemble? Yes, that’s right, another out-of-touch old wrinkly man with grey hair, he reminds you of none other than Old Worzel Gummidge himself, Michael Foot. There are a lot of parallels to draw, a hard left opposition with an incompetent vacillating leader, the attacks almost write themselves. However, you’ve probably alienated quite a few voters on Labour’s side, as the wounds with Thatcher and the 1980s miners strikes still run deep. However, you’re likely going to be effective with middle class homeowners in this campaign. </p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 208, \"fields\": {\"first_name\": \"\", \"last_name\": \"Soft Brexiteer\", \"election\": 20, \"party\": \"Conservatives\", \"state\": \"Westminster\", \"priority\": 13, \"description\": \"'\", \"color_hex\": \"#FF0000\", \"secondary_color_hex\": \"#FFA0A0\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineSoftBrexiteerConservative.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>When you received the keys to Number 10 Downing Street, everyone was curious how you’d direct your Premiership from the get-go, and it seems like you’ve took a rather diplomatic direction. You’ve been noticed talking a lot about Brexit, but in this way that’s more centred on the economics of the issue and that you’ve made it clear you’ll negotiate for a deal with Brussels. This approach has certainly dissatisfied many on the Hard Brexit side, including those in your party who might become problematic if you don’t tame them somehow. As well, despite its decline, your softer positions on Brexit as well as the amount you’re talking about it could potentially reanimate the dying UKIP party to your right that could potentially skim some of your voters away from you. However, you’re really strengthening your seats against an encroachment by the Liberal Democrats in return.</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 209, \"fields\": {\"first_name\": \"\", \"last_name\": \"Old Labour\", \"election\": 20, \"party\": \"Labour\", \"state\": \"Westminster\", \"priority\": 14, \"description\": \"'\", \"color_hex\": \"#DC241f\", \"secondary_color_hex\": \"#90C0FF\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineOldLabour.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>As expected, you have pivoted the Labour Party dramatically to the left, reflecting the traditions of Old Labour greats like Clement Attlee. This is a drastic change from the small reforms away from Third-Way Blairism that Gordon Brown and later Ed Miliband engaged in. Labour finally actually stands for Labour, once again rooted in its traditions of a party standing for organised labour and trade unions. This appeal is what led you to trounce the opposition in the Labour leadership race, and you have stuck wholly by the appeal. However, whilst your base love you, your party and the insiders do not, and unless you repair your relations to them, you might be subject to them undermining your campaign in ways you might not be prepared for.  You maintained a neutral stance in the 2016 referendum and shook off an attempted leadership challenge from Owen Smith, but the party is in dire shape following this attempt.</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 210, \"fields\": {\"first_name\": \"\", \"last_name\": \"Progressive Labour\", \"election\": 20, \"party\": \"Labour\", \"state\": \"Westminster\", \"priority\": 15, \"description\": \"'\", \"color_hex\": \"#193BCF\", \"secondary_color_hex\": \"#90C0FF\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineProgressiveLabour.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>What’s been noticed by your leadership of Labour is less your leftwards pivot from the previous leadership from an economic standpoint, but instead a social standpoint. You’ve made a point about making Labour a party more friendly to the LGBT+ community and with greater minority representation, a lot of people in your Shadow Cabinet like Dianne Abbott and Dawn Butler are from non-white backgrounds which you have emphasised as part of the direction Labour as a party is taken. You’ve taken stronger stances than any of the other main parties about transgender rights, which could either help or hurt you. Overall, it’s expected you’ll be able to grow your numbers greatly in the cities, but this might not play as well in some Northern seats you need to hold off against a Conservative campaign for those seats.\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 212, \"fields\": {\"first_name\": \"\", \"last_name\": \"Pro-EU Labour\", \"election\": 20, \"party\": \"Labour\", \"state\": \"Westminster\", \"priority\": 16, \"description\": \"'\", \"color_hex\": \"#0000FF\", \"secondary_color_hex\": \"#90C0FF\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineProEULabour.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>After a notably strong campaign to Remain in 2016, it was relatively plain sailing until the country actually voted to Leave, leaving you in a bit of a conundrum. It’s not like you’re the only major candidate to campaign to Remain in 2016, the now-Prime Minister Theresa May did as well, so it’s not a dealbreaker to your leadership of Labour, but it does blunt the edge you have with Eurosceptics on the left in many potentially vulnerable seats. However, despite many expecting a leadership challenge sometime in 2016, the Labour party did not put up a candidate, acknowledging they have a tepid level of confidence in you, that is definitely very shaky, but it is there. Your enthusiasm is also high with many young voters who voted to Remain, but not so much with voters in crucial post-industrial swing seats who voted strongly to Leave. But it definitely could be worse than it is.</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 213, \"fields\": {\"first_name\": \"\", \"last_name\": \"Lexiteer Labour\", \"election\": 20, \"party\": \"Labour\", \"state\": \"Westminster\", \"priority\": 17, \"description\": \"'\", \"color_hex\": \"#0000FF\", \"secondary_color_hex\": \"#90C0FF\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineLexiteerLabour.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>You shockingly campaigned to Leave in 2016, a move that shocked many, especially David Cameron and his Government. This wasn’t fully unexpected for you however, as you did advocate an earlier membership referendum in 2011. But now… we’ve left, and you’re in a very interesting position. You faced a leadership challenge during the referendum campaign that you survived by single digits, and now are the only major party leader who voted to Leave in a country that also voted to Leave. This can help you, but your party is in complete shambles as well, with many MPs having resigned from your party en masse over your pro-Brexit positions. Now, with a party on the brink but the unique position of being the most in-touch with the general public's collective desire to break off from Brussels, are you able to carry this momentum to victory?</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 211, \"fields\": {\"first_name\": \"\", \"last_name\": \"Big Tent Labour\", \"election\": 20, \"party\": \"Labour\", \"state\": \"Westminster\", \"priority\": 18, \"description\": \"'\", \"color_hex\": \"#0000FF\", \"secondary_color_hex\": \"#90C0FF\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineBigTentLabour.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>Your narrow avoidance of a 2016 Labour Leadership challenge has shook up your world a little, you’ve realised something that you refused to acknowledge before, that party unity is very important, and to turn this race around, you need a united party you can work with. However, it’s not like you can just wish this into existence, this party unity must be worked for, and thus you have decided to make many concessions in order to keep things on Labour’s side more stable. This will probably help you electorally, but you’ve begun to notice that the crowds don’t cheer as loudly as they used to. This is going to be a difficult balancing act for you. Can you get the best of both worlds? At the moment, the establishment is tolerant of you. They don’t love you, but they accept you, but your supporters are starting to lose a little bit of enthusiasm, and party membership has plateaued. Can you make this work?</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 214, \"fields\": {\"first_name\": \"\", \"last_name\": \"Mainstream Liberal Democrat\", \"election\": 20, \"party\": \"Liberal Democrats\", \"state\": \"Westminster\", \"priority\": 19, \"description\": \"'\", \"color_hex\": \"#FFFF00\", \"secondary_color_hex\": \"#FFFFC0\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineMainstreamLibDem.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>You find yourself as the leader of a broken party, left in ruins by its previous leader, Deputy Prime Minister Nick Clegg, and you’re unsure what to do next. You hold off on making too many dramatic changes too quickly, staying the course for a while, sticking your finger into the air to calculate the political wind, so you can make the next right move. This has unfortunately continued to dampen enthusiasm for what was the third major party in British politics, but in the meantime you have left your options open for what is the right next move to make. Perhaps for that reason it isn’t as bad as it looks, you haven’t alienated anyone to too high of a degree yet, just everyone to a slight degree.</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 215, \"fields\": {\"first_name\": \"\", \"last_name\": \"Pro-EU Liberal Democrat\", \"election\": 20, \"party\": \"Liberal Democrats\", \"state\": \"Westminster\", \"priority\": 20, \"description\": \"'\", \"color_hex\": \"#00C100\", \"secondary_color_hex\": \"#A1FFA1\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineProEULibDem.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>The Brexit referendum could be your big break. In its rather tenuous end result of a 4 point victory between Leave and Remain, there may be 17 million Leavers, but those 16 million Remainers need a voice too, and you’re in a position where you can be that voice. Getting on this pro-EU train relatively early has definitely helped you with a segment of the population unimpressed by Corbyn’s apathy towards the EU, and gives you several inroads into a handful of seats. However, it might not help as much in the Liberal Democrats’ legacy rural seats, many of which voted to leave and are populated by voters that might be more turned off by this approach. Still, you know that the Lib Dems need a change in direction if they’re ever going to claw back some of their prestige from 2010, whether that be recovering the old coalition or building a new coalition of voters.</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 216, \"fields\": {\"first_name\": \"\", \"last_name\": \"Progressive Liberal Democrat\", \"election\": 20, \"party\": \"Liberal Democrats\", \"state\": \"Westminster\", \"priority\": 20, \"description\": \"'\", \"color_hex\": \"#00C100\", \"secondary_color_hex\": \"#A1FFA1\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineProgressiveLibDem.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>You stare at the state of your party, and struggle to decide what to do to build it back to what it used to be. But maybe the right answer is to lean into the niche of social issues, appealing to ideas of social progressivism more earnestly in order to rebuild the party. For who you are however, this is an interesting gamble. You have said some controversial statements about gay issues in the past, and these are likely to crop up, so you better have a good answer for how to respond to them. However if you can, then making the Liberal Democrats the party of progressivism against Labour’s more economic leanings, perhaps you can attract voters who lean socially progressive, but are not comfortable voting for Labour. Many seats in the Home Counties fit this mould, perhaps the Liberal Democrats can be the option they’re clamouring for.</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 217, \"fields\": {\"first_name\": \"\", \"last_name\": \"Business Liberal Democrat\", \"election\": 20, \"party\": \"Liberal Democrats\", \"state\": \"Westminster\", \"priority\": 20, \"description\": \"'\", \"color_hex\": \"#00C100\", \"secondary_color_hex\": \"#A1FFA1\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineBusinessLibDem.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>The results of the Brexit referendum scare the British business community. They of course are never going to support a left wing socialist like Jeremy Corbyn, but at the same time they’re uneasy about voting for Theresa May’s Conservative party who have been more permissive towards the excesses of Brexit that they’re not comfortable with. Seeing this, you decide to direct the Liberal Democrats towards the ideology of a pro-business and growth party. You have moved rightwards on economics towards free trade and deregulation, whilst maintaining your pro-EU stances. It’s expected this will help in affluent regions of the country where many professionals reside, at the expense of your legacy seats which tend to lean a little more working class. However, having big business on your side will likely mean a good relation with much of the press too.</p>\", \"candidate_score\": 0.0}}, {\"model\": \"campaign_trail.candidate\", \"pk\": 218, \"fields\": {\"first_name\": \"\", \"last_name\": \"Christian Liberal Democrat\", \"election\": 20, \"party\": \"Liberal Democrats\", \"state\": \"Westminster\", \"priority\": 20, \"description\": \"'\", \"color_hex\": \"#00C100\", \"secondary_color_hex\": \"#A1FFA1\", \"is_active\": 0, \"image_url\": \"https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/TimelineChristianLibDem.png\", \"electoral_victory_message\": \"'\", \"electoral_loss_message\": \"'\", \"no_electoral_majority_message\": \"'\", \"description_as_running_mate\": \"<p>Tim, you’re an interesting character to lead the Liberal Democrats, a leader who is explicit and proud about their Christian background. It’s been noted that you’ve held a lot of your hustings events in local parish churches with religious congregants. It’s looking like this is making you more relatable to older voters, although it doesn’t seem to be helping much with younger voters. Remaining rather open and vague outside of that means you have an identity, but haven’t committed yet to a direction you take the party. This identity might make you more able to make inroads with socially conservative churchgoing Christian voters who would normally vote Tory and as well reinforce the rural legacy seats that the Liberal Democrats are struggling to hold onto. With Clegg collapsing the party’s appeal, a new identity is what it needs, but is this Christian identity the one that will work?</p>\", \"candidate_score\": 0.0}}]");
 
campaignTrail_temp.opponents_default_json = JSON.parse("[{\"election\": 20, \"candidates\": [201, 23, 203, 200, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174]}]");
 
campaignTrail_temp.opponents_weighted_json = JSON.parse("[{\"election\": 20, \"candidates\": [201, 23, 203, 200, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174]}]");
 
campaignTrail_temp.running_mate_json = JSON.parse("[{\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 200, \"running_mate\": 204}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 200, \"running_mate\": 205}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 200, \"running_mate\": 206}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 200, \"running_mate\": 207}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 200, \"running_mate\": 208}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 201, \"running_mate\": 209}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 201, \"running_mate\": 210}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 201, \"running_mate\": 211}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 201, \"running_mate\": 212}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 201, \"running_mate\": 213}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 23, \"running_mate\": 214}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 23, \"running_mate\": 215}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 23, \"running_mate\": 216}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 23, \"running_mate\": 217}}, {\"model\": \"campaign_trail.running_mate\", \"pk\": 106, \"fields\": {\"candidate\": 23, \"running_mate\": 218}}]");
 
campaignTrail_temp.difficulty_level_json = JSON.parse("[{\"model\": \"campaign_trail.difficulty_level\", \"pk\": 1, \"fields\": {\"name\": \"Cakewalk\", \"multiplier\": 1.3}}, {\"model\": \"campaign_trail.difficulty_level\", \"pk\": 2, \"fields\": {\"name\": \"Very Easy\", \"multiplier\": 1.2}}, {\"model\": \"campaign_trail.difficulty_level\", \"pk\": 3, \"fields\": {\"name\": \"Easy\", \"multiplier\": 1.1}}, {\"model\": \"campaign_trail.difficulty_level\", \"pk\": 4, \"fields\": {\"name\": \"Quite Easy\", \"multiplier\": 1.05}}, {\"model\": \"campaign_trail.difficulty_level\", \"pk\": 5, \"fields\": {\"name\": \"Normal\", \"multiplier\": 1.0}}, {\"model\": \"campaign_trail.difficulty_level\", \"pk\": 6, \"fields\": {\"name\": \"Challenging\", \"multiplier\": 0.95}}, {\"model\": \"campaign_trail.difficulty_level\", \"pk\": 7, \"fields\": {\"name\": \"Hard\", \"multiplier\": 0.9}}, {\"model\": \"campaign_trail.difficulty_level\", \"pk\": 8, \"fields\": {\"name\": \"Very Hard\", \"multiplier\": 0.85}}, {\"model\": \"campaign_trail.difficulty_level\", \"pk\": 9, \"fields\": {\"name\": \"Impossible\", \"multiplier\": 0.8}}, {\"model\": \"campaign_trail.difficulty_level\", \"pk\": 10, \"fields\": {\"name\": \"Unthinkable\", \"multiplier\": 0.7}}, {\"model\": \"campaign_trail.difficulty_level\", \"pk\": 11, \"fields\": {\"name\": \"Blowout\", \"multiplier\": 0.6}}, {\"model\": \"campaign_trail.difficulty_level\", \"pk\": 12, \"fields\": {\"name\": \"Disaster\", \"multiplier\": 0.5}}]");
 
campaignTrail_temp.temp_election_list = [{"id": 20, "year": 2017, "is_premium": 0, "display_year": "2017 UK - Redux"}];
 
const introTitle = document.querySelector("#inner_window_1 h3");
  if (introTitle) {
	introTitle.textContent = "Do you have what it takes to win a General Election?";
  }
 
document.getElementById("inner_window_1").children[1].innerHTML = `<li>How will Britain fare in a post-Brexit world? </li><li>You will answer questions about your platform and positions, and also about your campaign strategy.</li><li>The answers will affect your popularity for better or worse, both nationally and in individual constituencies.</li><li>Manage your appeal across different groups. Maintain your base whilst reaching out to new voters.</li><li>Based on previous answers and how you appeal to different groups, your campaign can be affected.</li><li>If you aren’t too knowledgeable about British politics, try playing on Easy at first.</li><li>If you are knowledgeable about British politics, you should feel comfortable playing on Normal difficulty.</li>`;
document.styleSheets[0].insertRule(".inner_window_w_desc{ margin:1em 0 0 0.5em !important;padding-top: 0.5em !important;}", 0);
document.styleSheets[0].insertRule(".inner_window_question{ margin:1em 0 .7em 0.5em !important;padding-top: 0.3em !important;}", 0);
document.styleSheets[0].insertRule("#main_content_area { height:82% !important;}", 0);
 
campaignTrail_temp.show_premium = true;
campaignTrail_temp.premier_ab_test_version = -1;
 
let style = document.createElement('style');style.innerHTML = `#overall_result {overflow: auto;}`;document.head.appendChild(style);
 
document.getElementById("header").src = "https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/Banner.png"
$("#game_window")[0].style.backgroundColor = "#001107"
nct_stuff.themes[nct_stuff.selectedTheme].coloring_title = "#003015"
nct_stuff.themes[nct_stuff.selectedTheme].coloring_window = "#CAB8AC"
document.getElementsByClassName("game_header")[0].style.backgroundColor = "#E4CE9C"
nct_stuff.themes[nct_stuff.selectedTheme].coloring_title = "#291000"
$(".container")[0].style.backgroundColor = "#003015"
document.body.background = "https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/Commons.jpeg"
 
function updateCandidateForm() {
  formobserver.disconnect();
  const heading = document.querySelector("#candidate_form form h3");
 
  if (heading) {
    heading.textContent = "Please select your candidate and party:";
  }
  formobserver.observe(document.documentElement, { childList: true, subtree: true });
}
 
var formobserver = new MutationObserver(updateCandidateForm);
formobserver.observe(document.documentElement, { childList: true, subtree: true });
 
function updateRunningMateForm() {
  runformobserver.disconnect();
  const heading = document.querySelector("#running_mate_form form h3");
 
  if (heading) {
    heading.textContent = "Please select your campaign’s timeline:";
  }
  runformobserver.observe(document.documentElement, { childList: true, subtree: true });
}
 
var runformobserver = new MutationObserver(updateRunningMateForm);
runformobserver.observe(document.documentElement, { childList: true, subtree: true });
 
function updateHeader() {
  var gameHeader = document.getElementsByClassName("game_header")[0];
 
  if (gameHeader.getAttribute("id") !== "modifiedHeader") {
    gameHeader.innerHTML = corrr;
    gameHeader.style.backgroundColor = nct_stuff.themes[nct_stuff.selectedTheme].coloring_title;
    gameHeader.setAttribute("id", "modifiedHeader");
  }
}
 
var headerobserver = new MutationObserver(updateHeader);
headerobserver.observe(document.documentElement, { childList: true, subtree: true });
 
HistHexcolour=["#0087DC","#DC241F","#FAA61A","#FFFF00","#70147A","#6AB023","#D46A4C","#008800","#008240","#99FF66","#9999FF","#F6CB2F","#E0E0E0","#888888"];
HistName=[" Theresa May - Conservatives"," Jeremy Corbyn - Labour"," Tim Farron - Liberal Democrats","Nicola Sturgeon - SNP", "Paul Nuttall - UKIP", "Caroline Lucas and Jonathan Bartley - Green", "Arlene Foster - DUP", "Gerry Adams - Sinn Féin", "Leanne Wood - Plaid Cymru", "Colum Eastwood - SDLP", "Robin Swann - UUP", "Naomi Long - Alliance", "John Bercow - Speaker", "Independent/Other"];
HistEV=[317,262,12,35,0,1,10,7,4,0,0,0,1,1]; 
HistPV=["13,636,684","12,977,918","2,371,861","977,568","594,068","512,327","292,316","238,915","164,466","95,419","83,280","64,553","34,299","289,838"];
HistPVP=["42.3%","40.0%","7.4%","3.4%","1.8%","1.6%","0.9%","0.7%","0.5%","0.3%","0.3%","0.2%","0.1%","0.9%"];
 
RecReading=true
 
campaignTrail_temp.credits = '@BriocheWindows';
 
campaignTrail_temp.credits = "<button onclick='credits()'>Briochewindows</button>";
 
credits = function() {
  credits = ["CODER", "Briochewindows", "", "WRITERS",  "Briochewindows", "", "PLAYTESTERS", "Astro", "SkyBlue", "CitySlicker", "packerp", "Snazzrazz Mazzlejazz", "amlab19", "TotalRozza", "Fraser", "donut", "McFish", "original name", "A.J", "Killeritch", "General Ta", "AverageLaborPatriot", "_mango", "AngryGandhi", "-And many others!", "", "Special Thanks", "Tomahawk2K (for the coalition system)", "munastronaut (for fixing that coalition bug", "TheMcCain (for fixing the candidate menu bugs)"]
  text = "CREDITS:\n\n"
  for (i in credits) {
  	text += credits[i] + "\n"
  }
  alert(text)
}
 
e.collect_results = true;
 
e = campaignTrail_temp
 
let previousCandidateId = null;
function handleCandidateView() {
    const candidateButton = document.getElementById("candidate_id_button");
    const runningMateButton = document.getElementById("running_mate_id_button");
    const candidateSummary = document.querySelector("#candidate_summary > ul");
    const candidateIdElement = document.getElementById("candidate_id");
    const c = Number(candidateIdElement?.value) ?? -1;
    const candObj = e.candidate_json.find((f) => f.pk === c);

if (candidateButton) {
if (c === 200 || c === 201) {
    candidateButton.style.display = "";
} else {
    candidateButton.style.display = "none";
}
    previousCandidateId = c;
}
 if (candidateButton) {
  // add the code that changes styles here
}
}

 
function startCandidateWatcher() {
    setInterval(() => {
        const candidateIdElement = document.getElementById("candidate_id");
        const currentValue = Number(candidateIdElement?.value) ?? -1;
 
        if (currentValue !== previousCandidateId) {
            handleCandidateView();
        }
    }, 100);
}
 
function waitForCandidateForm() {
    const targetNode = document.getElementById("candidate_form");
 
    if (targetNode) {
        const newObserver = new MutationObserver((mut, obs) => {
            handleCandidateView();
        });
 
        newObserver.observe(targetNode, { childList: true, subtree: true });
 
        startCandidateWatcher();
        handleCandidateView();
    } else {
        setTimeout(waitForCandidateForm, 100);
    }
}
 
waitForCandidateForm();
 
 
function appendStyle() {
    if (!document.querySelector('meta[name="viewport"]')) {
        const metaTag = document.createElement('meta');
        metaTag.name = "viewport";
        metaTag.content = "width=device-width, initial-scale=1";
        document.head.appendChild(metaTag);
    }
 
    // Custom styles here
    if (!document.querySelector('#radio-option-style')) {
        const style = document.createElement('style');
        style.id = 'radio-option-style';
        style.textContent = `
            #results_container, #overall_details_container {
            color: #fff;
          }
        `;
        document.head.appendChild(style);
    }
}
 
appendStyle();
 
campaignTrail_temp.modBoxTheme = {
    "header_color": "#291000",
    //"header_image_url": "imageurlhere",
    "header_text_color": "#ffffff",
    "description_text_color": "#ffffff",
    "description_background_color": "#001107",
    "main_color": "#003015",
    "secondary_color": "#291000",
    "ui_text_color": "#FFFFFF"

    }

	// The music player!
// This was initially developed using the one from W. as a basis, which is also why the
// album covers are not particularly huge. This might change. Still, it's a *lot* different
// than the one there, but I must give out some attribution here.

(function () {
    'use strict';

    // The songs.
    const SONGS_DATA = [
	{ title: "Rebellion (Lies)", artist: "Arcade Fire", coverLink: "https://t2.genius.com/unsafe/344x344/https%3A%2F%2Fimages.genius.com%2F1a443e2631189d3cc8147063ff90ef7c.660x660x1.jpg", videoIds: ["UcU-zHIDQJ0"] },
	{ title: "1234", artist: "Feist", coverLink: "https://t2.genius.com/unsafe/344x344/https%3A%2F%2Fimages.genius.com%2Fa9c8a56534ca76a1241854244bc5a214.1000x873x1.png", videoIds: ["N5tHRTvDPOI"] },
        { title: "Chicago", artist: "Sufjan Stevens", coverLink: "https://t2.genius.com/unsafe/344x344/https%3A%2F%2Fimages.genius.com%2F9ece496995bb452d49518c2eb396a16d.1000x1000x1.jpg", videoIds: ["c_-cUdmdWgU"] },
        { title: "Diamonds From Sierra Leone (Remix)", artist: "Kanye West", coverLink: "https://t2.genius.com/unsafe/344x344/https%3A%2F%2Fimages.genius.com%2F413ad585ebd74a2f16a1bbecd74253a8.994x994x1.png", videoIds: ["4q7OpvvfjWs"] },
        { title: "Phantom Limb", artist: "The Shins", coverLink: "https://t2.genius.com/unsafe/344x344/https%3A%2F%2Fimages.genius.com%2F43b30ef6e80083ddc0d5b38908df71fb.600x607x1.jpg", videoIds: ["XoMAbmZw3mI"] }
    ];

    let PLAYLISTS_DATA = [];

    // constants
    const PLAYER_ELEMENT_ID = "nice-music-player";
    const PLAYER_MAIN_CONTENT_WRAPPER_ID = "player-main-content-wrapper";
	const PLAYER_RIGHT_PANEL_ID = "player-right-panel";
    const PLAYLIST_SELECTOR_CONTAINER_ID = "player-playlist-selector-container";
    const PLAYLIST_SELECTOR_ID = "player-playlist-selector";
    const YOUTUBE_PLAYER_DIV_ID = "youtube-player-container";
    const DISPLAY_BOX_ID = "player-display-box";
    const COVER_ID = "player-cover";
    const INFO_CONTAINER_ID = "player-info-container";
    const SONG_INFO_ID = "player-song-info";
    const TITLE_LINE_WRAPPER_CLASS = "player-title-line-wrapper";
    const TITLE_ID = "player-title";
    const ARTIST_ID = "player-artist";
    const YOUTUBE_LINK_ID = "player-youtube-link";
    const CONTROLS_CONTAINER_ID = "player-controls-container";
    const CONTROLS_ID = "player-controls";
    const PREV_BUTTON_ID = "player-prev-button";
    const PLAY_PAUSE_BUTTON_ID = "player-play-pause-button";
    const NEXT_BUTTON_ID = "player-next-button";
    const PROGRESS_BAR_CONTAINER_ID = "player-progress-bar-container";
    const CURRENT_TIME_ID = "player-current-time";
    const PROGRESS_BAR_ID = "player-progress-bar";
    const DURATION_ID = "player-duration";
    const VOLUME_CONTAINER_ID = "player-volume-container";
    const VOLUME_ICON_ID = "player-volume-icon";
    const VOLUME_PERCENTAGE_ID = "player-volume-percentage";
    const VOLUME_SLIDER_ID = "player-volume-slider";
    const REPEAT_BUTTON_ID = "player-repeat-button";
    const SHUFFLE_BUTTON_ID = "player-shuffle-button";
    const PLAYER_CONTROL_BUTTON_CLASS = 'player-control-button';
    const QUEUE_CONTAINER_ID = "player-queue-container";
    const QUEUE_TITLE_ID = "player-queue-title";
    const QUEUE_LIST_ID = "player-queue-list";
    const PLAYER_QUEUE_ITEM_CLASS = "player-queue-item";
    const QUEUE_TOGGLE_ICON_ID = "player-queue-toggle-icon";

    // icons
    const ICON_PLAY = "https://upload.wikimedia.org/wikipedia/commons/9/96/Crystal_Project_Player_play.png";
    const ICON_PAUSE = "https://upload.wikimedia.org/wikipedia/commons/d/dd/Crystal_Project_Player_pause.png";
    const ICON_PREV = "https://upload.wikimedia.org/wikipedia/commons/e/ef/Crystal_Project_Player_rew.png";
    const ICON_NEXT = "https://upload.wikimedia.org/wikipedia/commons/6/66/Crystal_Project_Player-end.png";
    const ICON_VOLUME = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24' fill='%23424242'%3E%3Cpath d='M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z'/%3E%3C/svg%3E";
    const ICON_MUTED = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24' fill='%23424242'%3E%3Cpath d='M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z'/%3E%3C/svg%3E";
    const ICON_YOUTUBE = "https://upload.wikimedia.org/wikipedia/commons/b/b8/YouTube_play_button_icon_%282013%E2%80%932017%29.svg";
    const ICON_REPEAT_NONE = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24' fill='%23424242'%3E%3Cpath d='M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z'/%3E%3C/svg%3E";
    const ICON_REPEAT_ALL = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24' fill='%233F51B5'%3E%3Cpath d='M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z'/%3E%3C/svg%3E";
    const ICON_REPEAT_ONE = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='24' height='24' fill='%233F51B5'%3E%3Cpath d='M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z'/%3E%3Cpath d='M13 15V9h-1l-2 1v1h1.5v4z'/%3E%3C/svg%3E";
	const ICON_SHUFFLE_OFF = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='24' width='24' viewBox='0 0 24 24' fill='%23424242'%3E%3Cpath d='M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm0.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z'/%3E%3C/svg%3E";
	const ICON_SHUFFLE_ON = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='24' width='24' viewBox='0 0 24 24' fill='%233F51B5'%3E%3Cpath d='M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm0.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z'/%3E%3C/svg%3E";

    class Song {
        constructor(title, artist, coverLink, videoIds) {
            this.title = title;
            this.artist = artist;
            this.coverLink = coverLink;
            this.videoIds = Array.isArray(videoIds) ? videoIds : [videoIds];
            this.currentVideoIndex = 0; // to track which video to try
        }
        getTitle() { return this.title; }
        getArtist() { return this.artist; }
        getCoverLink() { return this.coverLink; }
        
        // gets the video ID for the current attempt
        getCurrentVideoId() {
            return this.videoIds && this.videoIds.length > 0 ? this.videoIds[this.currentVideoIndex] : null;
        }

        // gets the YouTube link for the video that is currently being attempted
        getYoutubeLink() {
            const videoId = this.getCurrentVideoId();
            return videoId ? `https://www.youtube.com/watch?v=${videoId}` : '#';
        }

        // tries to switch to the next available video ID
        // returns true if there is a next video, false otherwise
        tryNextVideo() {
            if (this.currentVideoIndex < this.videoIds.length - 1) {
                this.currentVideoIndex++;
                return true;
            }
            return false;
        }

        // resets the video index to the primary one (the first in the array)
        resetVideoIndex() {
            this.currentVideoIndex = 0;
        }
    }
    class Playlist {
        constructor(songs = []) { this.songs = songs; this.currentSongIndex = 0; }
        addSong(song) { this.songs.push(song); }
        getCurrentSong() { return this.songs.length > 0 ? this.songs[this.currentSongIndex] : null; }
        playNext() { if (this.songs.length > 0) this.currentSongIndex = (this.currentSongIndex + 1) % this.songs.length; }
        playPrevious() { if (this.songs.length > 0) this.currentSongIndex = (this.currentSongIndex - 1 + this.songs.length) % this.songs.length; }
        setCurrentSongIndex(index) { if (index >= 0 && index < this.songs.length) this.currentSongIndex = index; else console.warn(`Invalid song index: ${index}`); }
        isEmpty() { return this.songs.length === 0; }
        getSongs() { return this.songs; }
        setSongs(newSongs) { this.songs = newSongs; }
    }

    let playlist;
    let activePlaylistIndex = 0;
    let originalSongOrderForCurrentPlaylist = [];
    let isShuffleActive = false;
    let ytPlayer;
    let playerReady = false;
    let isSeeking = false;
    let rafId = null;
    let isUpdaterRunning = false;
    let volumeBeforeMute = 0.5;
    let repeatMode = 'none';

    let hasUserInitiatedPlayback = true; // prevents initial autoplay
    let isQueueSectionExpanded = true; // for collapsible queue

    const TARGET_FPS = 30;
    const FRAME_INTERVAL = 1000 / TARGET_FPS;
    let lastRafUpdateTime = 0;
    let playerShouldBeUpdatingWhenVisible = false;
    const MAX_QUEUE_ITEMS_DISPLAYED = 5;

    let playerContainer, mainContentWrapper, playlistSelectorContainer, playlistSelectorElement;
    let coverElement, titleElement, artistElement, youtubeLinkElement;
    let playPauseButton, prevButtonElement, nextButtonElement, progressBar, currentTimeElement, durationElement;
    let volumeContainer, volumeIconElement, volumePercentageElement, volumeSlider;
    let repeatButtonElement, shuffleButtonElement;
    let queueContainerElement, queueTitleElement, queueListElement;

    function formatTime(totalSeconds) {
        if (isNaN(totalSeconds) || totalSeconds < 0) { return "--:--"; }
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = Math.floor(totalSeconds % 60);
        return `${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
    }
    function shuffleArray(array) {
        let currentIndex = array.length, randomIndex;
        const newArray = [...array];
        while (currentIndex !== 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [newArray[currentIndex], newArray[randomIndex]] = [newArray[randomIndex], newArray[currentIndex]];
        }
        return newArray;
    }

    function updateUI() {
        const currentSong = playlist?.getCurrentSong();
        if (!coverElement || !titleElement || !artistElement || !youtubeLinkElement) {
            return;
        }

        if (!currentSong) {
            coverElement.src = ""; coverElement.alt = "No cover art";
            titleElement.textContent = "No song loaded"; titleElement.title = "";
            artistElement.textContent = ""; artistElement.title = "";
            youtubeLinkElement.href = "#"; youtubeLinkElement.classList.add('hidden');
            if (playPauseButton) updatePlayPauseButton(true);
            if (progressBar) { progressBar.value = 0; progressBar.style.setProperty('--progress-percent', '0%'); }
            if (currentTimeElement) currentTimeElement.textContent = "0:00";
            if (durationElement) durationElement.textContent = "--:--";
        } else {
            coverElement.src = currentSong.getCoverLink(); coverElement.alt = `Cover art for ${currentSong.getTitle()}`;
            const songTitle = currentSong.getTitle();
            titleElement.textContent = songTitle; titleElement.title = songTitle;
            const songArtist = currentSong.getArtist();
            artistElement.textContent = songArtist; artistElement.title = songArtist;
            youtubeLinkElement.href = currentSong.getYoutubeLink(); youtubeLinkElement.classList.remove('hidden');
        }

        if (playerReady && ytPlayer && typeof ytPlayer.getPlayerState === 'function' && hasUserInitiatedPlayback) {
            const state = ytPlayer.getPlayerState();
            if (playPauseButton) updatePlayPauseButton(state !== YT.PlayerState.PLAYING && state !== YT.PlayerState.BUFFERING);
            updateDurationDisplay();
        } else {
            if (playPauseButton) updatePlayPauseButton(true);
            if (durationElement) durationElement.textContent = "--:--";
        }
        updateVolumeIcon();
        if (repeatButtonElement) updateRepeatButtonUI();
        if (shuffleButtonElement) updateShuffleButtonUI();
        if (playlistSelectorElement) playlistSelectorElement.value = activePlaylistIndex.toString();
        updateQueueDisplay();
    }

    function updateDurationDisplay() { 
        if (!durationElement) return;
        if (!playerReady || !ytPlayer || typeof ytPlayer.getDuration !== 'function' || !hasUserInitiatedPlayback) {
            durationElement.textContent = "--:--";
            return;
        }
        const duration = ytPlayer.getDuration();
        durationElement.textContent = formatTime(duration);
    }

    function loadCurrentSong(autoplay = false, isRetry = false) {
        console.debug(`loadCurrentSong called, autoplay=${autoplay}, isRetry=${isRetry}`);
        const currentSong = playlist?.getCurrentSong();

        // if this is a fresh attempt to play a song (not a retry from an error),
        // reset its video index to the primary one
        if (currentSong && !isRetry) {
            currentSong.resetVideoIndex();
        }

        updateUI();
        stopRafUpdater();
        if (progressBar) { progressBar.value = 0; progressBar.style.setProperty('--progress-percent', '0%'); }
        if (currentTimeElement) currentTimeElement.textContent = "0:00";
        if (durationElement) durationElement.textContent = "--:--";

        if (!playerReady || !ytPlayer || typeof ytPlayer.loadVideoById !== 'function') {
             console.warn("Player not ready or loadVideoById unavailable. Cannot load song.");
             if (playPauseButton) updatePlayPauseButton(true);
             return;
        }

        if (!currentSong) {
            console.warn("No current song to load.");
            if (typeof ytPlayer.stopVideo === 'function') ytPlayer.stopVideo();
             if (playPauseButton) updatePlayPauseButton(true);
            return;
        }

        const videoIdToLoad = currentSong.getCurrentVideoId();
        if (!videoIdToLoad) {
            console.error(`No video ID found for "${currentSong.getTitle()}". Skipping.`);
            onPlayerError({ data: 100 }); // simulate a "not found" error
            return;
        }
        
        console.log(`Loading video: ${videoIdToLoad} - ${currentSong.getTitle()}`);
        ytPlayer.loadVideoById({
            videoId: videoIdToLoad,
            startSeconds: 0,
            suggestedQuality: 'small'
        });
        window._musicPlayerAutoplayIntent = autoplay;
    }

    function loadNewPlaylistByIndex(newPlaylistIndex, autoplayOverride = null) {
        if (newPlaylistIndex < 0 || newPlaylistIndex >= PLAYLISTS_DATA.length) {
            console.warn(`Invalid playlist index: ${newPlaylistIndex}`);
            return;
        }
        activePlaylistIndex = newPlaylistIndex;
        const selectedPlaylistData = PLAYLISTS_DATA[activePlaylistIndex];

        if (playerReady && ytPlayer && typeof ytPlayer.stopVideo === 'function' && hasUserInitiatedPlayback) {
            ytPlayer.stopVideo();
        }
        stopRafUpdater();

        const newSongs = selectedPlaylistData.songs.map(d => new Song(d.title, d.artist, d.coverLink, d.videoIds || d.videoId));
        originalSongOrderForCurrentPlaylist = [...newSongs];
        
        if (isShuffleActive) {
            const currentSongVideoId = playlist?.getCurrentSong()?.getCurrentVideoId();
            const shuffledNewSongs = shuffleArray(newSongs);
            playlist = new Playlist(shuffledNewSongs);
            if (currentSongVideoId) {
                const newIdx = playlist.getSongs().findIndex(s => s.videoIds.includes(currentSongVideoId));
                if (newIdx !== -1) playlist.setCurrentSongIndex(newIdx);
                else playlist.setCurrentSongIndex(0);
            } else {
                playlist.setCurrentSongIndex(0);
            }
        } else {
            playlist = new Playlist(newSongs);
            playlist.setCurrentSongIndex(0);
        }
        
        if (!hasUserInitiatedPlayback) {
            updateUI();
             loadCurrentSong(false);
        } else {
            let shouldAutoplayThisLoad = autoplayOverride === null ? true : autoplayOverride;
            loadCurrentSong(shouldAutoplayThisLoad);
        }
    }

    function togglePlayPause() {
        if (!playerReady || !ytPlayer || typeof ytPlayer.getPlayerState !== 'function') {
             console.warn("Player not ready, cannot toggle play/pause.");
             return;
        }

        if (!hasUserInitiatedPlayback) {
            if (playlist.isEmpty()) {
                console.warn("Cannot play: Playlist is empty.");
                return;
            }
            hasUserInitiatedPlayback = true;
            loadCurrentSong(true); // load the current (first) song and play it
        } else {
            const state = ytPlayer.getPlayerState();
            if (state === YT.PlayerState.PLAYING) {
                console.debug("Pausing video.");
                ytPlayer.pauseVideo();
            } else { // PAUSED, ENDED, CUED, UNSTARTED
                console.debug("Playing video.");
                if (playlist.isEmpty() && PLAYLISTS_DATA.length > 0 && PLAYLISTS_DATA[activePlaylistIndex].songs.length > 0) {
                    loadCurrentSong(true);
                } else if (!playlist.isEmpty()) {
                    if (state === YT.PlayerState.ENDED && repeatMode !== 'one') {
                        playlist.playNext();
                        loadCurrentSong(true);
                    } else {
                       ytPlayer.playVideo();
                    }
                } else {
                    console.warn("Cannot play: No songs in current playlist or no playlists available.");
                }
            }
        }
    }

    function updatePlayPauseButton(isPaused) { 
        if (!playPauseButton) return;
        const img = playPauseButton.querySelector('img');
        const label = isPaused ? "Play" : "Pause";
        if (img) {
            img.src = isPaused ? ICON_PLAY : ICON_PAUSE;
            img.alt = "";
        }
        playPauseButton.setAttribute('aria-label', label);
        playPauseButton.title = label;
    }
    function rafUpdateProgress(timestamp) { 
        if (!isUpdaterRunning) return;
        if (!playerReady || !ytPlayer || typeof ytPlayer.getCurrentTime !== 'function' || typeof ytPlayer.getDuration !== 'function' || !hasUserInitiatedPlayback) {
            stopRafUpdater(); return;
        }
        if (isSeeking) { rafId = requestAnimationFrame(rafUpdateProgress); return; }

        if (timestamp - lastRafUpdateTime >= FRAME_INTERVAL) {
            lastRafUpdateTime = timestamp;
            const currentTime = ytPlayer.getCurrentTime();
            const duration = ytPlayer.getDuration();
            if (duration && isFinite(duration) && duration > 0) {
                const progress = (currentTime / duration) * 100;
                if (progressBar) { progressBar.value = progress; progressBar.style.setProperty('--progress-percent', `${progress}%`); }
                if (currentTimeElement) currentTimeElement.textContent = formatTime(currentTime);
                if (durationElement && durationElement.textContent === "--:--") updateDurationDisplay();
            } else {
                if (progressBar) { progressBar.value = 0; progressBar.style.setProperty('--progress-percent', '0%'); }
                if (currentTimeElement) currentTimeElement.textContent = "0:00";
                if (durationElement) updateDurationDisplay();
            }
        }
        if (isUpdaterRunning) rafId = requestAnimationFrame(rafUpdateProgress);
        else { if (rafId) { cancelAnimationFrame(rafId); rafId = null; } }
    }
    function startRafUpdater() { 
        if (isUpdaterRunning) return;
        if (!playerReady || !ytPlayer || typeof ytPlayer.getPlayerState !== 'function' || ytPlayer.getPlayerState() !== YT.PlayerState.PLAYING || !hasUserInitiatedPlayback) {
            return;
        }
        if (document.visibilityState === 'hidden') {
            playerShouldBeUpdatingWhenVisible = true; return;
        }
        isUpdaterRunning = true; lastRafUpdateTime = 0;
        if (rafId) cancelAnimationFrame(rafId);
        rafId = requestAnimationFrame(rafUpdateProgress);
    }
    function stopRafUpdater() { 
        if (!isUpdaterRunning && !rafId) return;
        isUpdaterRunning = false;
        if (rafId) { cancelAnimationFrame(rafId); rafId = null; }
    }
    function handleVisibilityChange() { 
        if (!playerReady || !ytPlayer || typeof ytPlayer.getPlayerState !== 'function' || !hasUserInitiatedPlayback) return;
        if (document.visibilityState === 'hidden') {
            if (isUpdaterRunning) { stopRafUpdater(); playerShouldBeUpdatingWhenVisible = true; }
            else if (ytPlayer.getPlayerState() === YT.PlayerState.PLAYING) { playerShouldBeUpdatingWhenVisible = true; }
        } else if (document.visibilityState === 'visible') {
            if (playerShouldBeUpdatingWhenVisible) {
                playerShouldBeUpdatingWhenVisible = false;
                if (ytPlayer.getPlayerState() === YT.PlayerState.PLAYING) startRafUpdater();
            } else if (!isUpdaterRunning && ytPlayer.getPlayerState() === YT.PlayerState.PLAYING) {
                startRafUpdater();
            }
        }
    }

    function onPlayerReady(event) {
        console.log("YouTube player ready!");
        playerReady = true;
        setVolumeFromSlider(false);
        
        updateUI();
		updateVolumeIcon();
		
		if (hasUserInitiatedPlayback && playlist && !playlist.isEmpty()) {
            console.log("Attempting to autoplay first song...");
            loadCurrentSong(true);
        }

        if (document.visibilityState === 'visible' && ytPlayer.getPlayerState() === YT.PlayerState.PLAYING && hasUserInitiatedPlayback) {
            startRafUpdater();
        } else if (document.visibilityState === 'hidden' && ytPlayer.getPlayerState() === YT.PlayerState.PLAYING && hasUserInitiatedPlayback) {
            playerShouldBeUpdatingWhenVisible = true;
        }
    }

    function onPlayerStateChange(event) {
        const state = event.data;
        const stateName = Object.keys(YT.PlayerState).find(key => YT.PlayerState[key] === state) || 'UNKNOWN';
        //console.log(`Player state changed: ${state} (${stateName})`);

        if (state !== YT.PlayerState.UNSTARTED && state !== -1) {
        }

        updateDurationDisplay();

        switch (state) {
            case YT.PlayerState.PLAYING:
                if (playPauseButton) updatePlayPauseButton(false);
                startRafUpdater();
                updateUI();
                break;
            case YT.PlayerState.PAUSED:
                if (playPauseButton) updatePlayPauseButton(true);
                stopRafUpdater();
                break;
            case YT.PlayerState.ENDED:
                stopRafUpdater();
                if (playPauseButton) updatePlayPauseButton(true);
                if (progressBar) { progressBar.value = 100; progressBar.style.setProperty('--progress-percent', '100%'); }
                if (currentTimeElement && ytPlayer && typeof ytPlayer.getDuration === 'function') {
                    currentTimeElement.textContent = formatTime(ytPlayer.getDuration());
                }

                if (!hasUserInitiatedPlayback) {
                    updateUI();
                    return;
                }

                if (repeatMode === 'one') {
                    ytPlayer.seekTo(0, true);
                    ytPlayer.playVideo();
                } else {
                    const previousSongIndex = playlist.currentSongIndex;
                    playlist.playNext();
                    
                    const isLastSongAndNotRepeatingAll = playlist.currentSongIndex === 0 && 
                                                        previousSongIndex === playlist.getSongs().length -1 && 
                                                        repeatMode !== 'all';
                    
                    let shouldAutoplay;
                    if (isLastSongAndNotRepeatingAll) {
                        shouldAutoplay = false;
                    } else {
                        shouldAutoplay = true;
                    }
                    loadCurrentSong(shouldAutoplay);
                }
                break;
            case YT.PlayerState.BUFFERING:
                if (playPauseButton) updatePlayPauseButton(false);
                break;
            case YT.PlayerState.CUED:
                if (playPauseButton) updatePlayPauseButton(true);
                stopRafUpdater();
                if (progressBar) { progressBar.value = 0; progressBar.style.setProperty('--progress-percent', '0%'); }
                if (currentTimeElement) currentTimeElement.textContent = "0:00";
                updateUI(); 
                updateDurationDisplay(); 

                if (window._musicPlayerAutoplayIntent === true) {
                    ytPlayer.playVideo();
                }
                break;
            case YT.PlayerState.UNSTARTED:
                if (playPauseButton) updatePlayPauseButton(true);
                stopRafUpdater();
                if (currentTimeElement) currentTimeElement.textContent = "0:00";
                if (durationElement) durationElement.textContent = "--:--";
                updateUI();
                break;
            default: break;
        }
    }
    function onPlayerError(event) { 
        const recoverableErrorCodes = [2, 5, 100, 101, 150];
        const errorCodes = { 2: 'Invalid parameter.', 5: 'HTML5 error.', 100: 'Not found/private.', 101: 'Embedding disallowed.', 150: 'Embedding disallowed.' };
        const errorMsg = errorCodes[event.data] || `Unknown error (${event.data})`;
        console.error(`YouTube Player Error: ${errorMsg}`);

        const currentSong = playlist?.getCurrentSong();

        // if the error is recoverable (e.g., video blocked), try the next available video ID
        if (currentSong && recoverableErrorCodes.includes(event.data)) {
            console.log(`Video failed for "${currentSong.getTitle()}". Checking for alternatives...`);
            if (currentSong.tryNextVideo()) {
                console.log(`Found an alternative. Attempting to play video ID: ${currentSong.getCurrentVideoId()}`);
                // reload the song with the next video ID. isRetry=true prevents resetting the video index
                loadCurrentSong(window._musicPlayerAutoplayIntent, true);
                return; // stop further error processing for this event
            } else {
                console.warn(`No more alternative videos for "${currentSong.getTitle()}".`);
            }
        }

        // handle final/unrecoverable errors
        if (playPauseButton) updatePlayPauseButton(true);
        stopRafUpdater();
        if (titleElement) titleElement.textContent = "Error";
        if (artistElement) artistElement.textContent = errorMsg;
    }
    function setVolumeFromSlider(shouldUnmute = true) {
		if (!volumeSlider || !volumePercentageElement) return;
		const volumeValue = parseFloat(volumeSlider.value);
		const newVolumePercent = Math.round(volumeValue * 100);

		if (playerReady && ytPlayer && typeof ytPlayer.setVolume === 'function') {
			ytPlayer.setVolume(newVolumePercent);
			if (shouldUnmute && newVolumePercent > 0 && typeof ytPlayer.isMuted === 'function' && ytPlayer.isMuted()) {
				ytPlayer.unMute();
			}
			if (newVolumePercent === 0 && typeof ytPlayer.mute === 'function' && !ytPlayer.isMuted()) {
				ytPlayer.mute();
			}
		}
		
		volumePercentageElement.textContent = `${newVolumePercent}%`;
	}
	function toggleMute() {
		if (!playerReady || !ytPlayer || !volumeSlider || !volumeIconElement) return;

		const isCurrentlyMuted = ytPlayer.isMuted();

		if (isCurrentlyMuted) {
			ytPlayer.unMute();
			const restoreVolume = (volumeBeforeMute > 0) ? volumeBeforeMute : 0.5;
			ytPlayer.setVolume(restoreVolume * 100);
			volumeSlider.value = restoreVolume;
			if (volumePercentageElement) {
				volumePercentageElement.textContent = `${Math.round(restoreVolume * 100)}%`;
			}
			volumeIconElement.src = ICON_VOLUME;
			volumeIconElement.alt = "Mute";
			volumeIconElement.title = "Mute";

		} else {
			const currentSliderValue = parseFloat(volumeSlider.value);
			if (currentSliderValue > 0) {
				volumeBeforeMute = currentSliderValue;
			}
			
			ytPlayer.mute();
			volumeSlider.value = 0;
			if (volumePercentageElement) {
				volumePercentageElement.textContent = `0%`;
			}
			
			volumeIconElement.src = ICON_MUTED;
			volumeIconElement.alt = "Unmute";
			volumeIconElement.title = "Unmute";
		}
	}
    function updateVolumeIcon() {
		if (!volumeIconElement || !volumeSlider) return;

		const sliderValue = parseFloat(volumeSlider.value);
		const isMutedBySlider = sliderValue === 0;

		let isMutedByPlayer = false;
		if (playerReady && ytPlayer && typeof ytPlayer.isMuted === 'function') {
			isMutedByPlayer = ytPlayer.isMuted();
		}
		
		const isEffectivelyMuted = isMutedBySlider || isMutedByPlayer;

		volumeIconElement.src = isEffectivelyMuted ? ICON_MUTED : ICON_VOLUME;
		volumeIconElement.alt = isEffectivelyMuted ? "Unmute" : "Mute";
		volumeIconElement.title = isEffectivelyMuted ? "Unmute" : "Mute";
	}
    function toggleRepeatMode() { 
        switch (repeatMode) {
            case 'none': repeatMode = 'all'; break;
            case 'all': repeatMode = 'one'; break;
            case 'one': repeatMode = 'none'; break;
            default: repeatMode = 'none';
        }
        updateRepeatButtonUI();
        updateQueueDisplay();
    }
    function updateRepeatButtonUI() { 
        if (!repeatButtonElement) return;
        const img = repeatButtonElement.querySelector('img');
        let iconSrc = ICON_REPEAT_NONE; let label = "Repeat Off";
        repeatButtonElement.classList.remove('repeat-active', 'repeat-one');
        if (repeatMode === 'all') { iconSrc = ICON_REPEAT_ALL; label = "Repeat All"; repeatButtonElement.classList.add('repeat-active'); }
        else if (repeatMode === 'one') { iconSrc = ICON_REPEAT_ONE; label = "Repeat One"; repeatButtonElement.classList.add('repeat-active', 'repeat-one'); }
        if (img) { img.src = iconSrc; img.alt = ""; }
        repeatButtonElement.setAttribute('aria-label', label); repeatButtonElement.title = label;
    }
    function toggleShuffleMode() { 
        if (!playlist || playlist.isEmpty()) return;

        isShuffleActive = !isShuffleActive;
        const currentSongBeforeToggle = playlist.getCurrentSong();

        if (isShuffleActive) {
            const shuffledSongs = shuffleArray(originalSongOrderForCurrentPlaylist);
            playlist.setSongs(shuffledSongs);
        } else {
            playlist.setSongs([...originalSongOrderForCurrentPlaylist]);
        }

        if (currentSongBeforeToggle) {
            const newIndex = playlist.getSongs().findIndex(song => song.getCurrentVideoId() === currentSongBeforeToggle.getCurrentVideoId());
            playlist.setCurrentSongIndex(newIndex !== -1 ? newIndex : 0);
        } else {
            playlist.setCurrentSongIndex(0);
        }

        updateShuffleButtonUI();
        updateQueueDisplay();
        updateUI();
    }
    function updateShuffleButtonUI() { 
        if (!shuffleButtonElement) return;
        const img = shuffleButtonElement.querySelector('img');
        let iconSrc = isShuffleActive ? ICON_SHUFFLE_ON : ICON_SHUFFLE_OFF;
        let label = isShuffleActive ? "Shuffle On" : "Shuffle Off";
        shuffleButtonElement.classList.toggle('shuffle-active', isShuffleActive);
        if (img) { img.src = iconSrc; img.alt = ""; }
        shuffleButtonElement.setAttribute('aria-label', label); shuffleButtonElement.title = label;
    }

    function updateQueueDisplay() {
        if (!queueListElement || !playlist) {
            if (queueListElement) queueListElement.innerHTML = `<li class="${PLAYER_QUEUE_ITEM_CLASS} player-queue-empty">Queue is empty</li>`;
            if (queueTitleElement) queueTitleElement.style.display = (playlist && !playlist.isEmpty() && PLAYLISTS_DATA.length > 0) ? 'flex' : 'none'
            return;
        }
        if (queueTitleElement) queueTitleElement.style.display = 'flex';

        if (playlist.isEmpty()){
            queueListElement.innerHTML = `<li class="${PLAYER_QUEUE_ITEM_CLASS} player-queue-empty">Queue is empty</li>`;
            return;
        }


        queueListElement.innerHTML = '';
        const songs = playlist.getSongs();
        const currentIndex = playlist.currentSongIndex;
        const numSongs = songs.length;

        if (numSongs <= 1) {
            queueListElement.innerHTML = `<li class="${PLAYER_QUEUE_ITEM_CLASS} player-queue-empty">No upcoming songs</li>`;
            return;
        }

        let songsShownCount = 0;
        for (let i = 1; i < numSongs && songsShownCount < MAX_QUEUE_ITEMS_DISPLAYED; i++) {
            let nextIndex = (currentIndex + i) % numSongs;
            if (repeatMode !== 'all' && !isShuffleActive && nextIndex < (currentIndex + i) && nextIndex < currentIndex) {
                break; 
            }
            
            const song = songs[nextIndex];
            const li = document.createElement("li");
            li.className = PLAYER_QUEUE_ITEM_CLASS;
            li.dataset.songIndex = nextIndex;

            const titleSpan = document.createElement("span");
            titleSpan.className = "player-queue-item-title";
            titleSpan.textContent = song.getTitle();
            titleSpan.title = song.getTitle();

            const artistSpan = document.createElement("span");
            artistSpan.className = "player-queue-item-artist";
            artistSpan.textContent = ` - ${song.getArtist()}`;
            artistSpan.title = song.getArtist();

            li.appendChild(titleSpan);
            li.appendChild(artistSpan);

            li.addEventListener('click', () => {
                if (!hasUserInitiatedPlayback) {
                    hasUserInitiatedPlayback = true;
                }
                const songIndexToPlay = parseInt(li.dataset.songIndex, 10);
                playlist.setCurrentSongIndex(songIndexToPlay);
                loadCurrentSong(true);
            });
            queueListElement.appendChild(li);
            songsShownCount++;
        }

        if (songsShownCount === 0 && queueListElement.innerHTML === '') {
             queueListElement.innerHTML = `<li class="${PLAYER_QUEUE_ITEM_CLASS} player-queue-empty">End of playlist</li>`;
        }
    }

    function toggleQueueExpansion() {
        isQueueSectionExpanded = !isQueueSectionExpanded;
        const queueContainer = document.getElementById(QUEUE_CONTAINER_ID);
        const toggleIcon = document.getElementById(QUEUE_TOGGLE_ICON_ID);

        if (!queueContainer || !toggleIcon) return;

        if (isQueueSectionExpanded) {
            queueContainer.classList.remove('queue-collapsed');
            toggleIcon.innerHTML = "▼"; // down arrow ▼
        } else {
            queueContainer.classList.add('queue-collapsed');
            toggleIcon.innerHTML = "▶"; // right arrow ►
        }
    }
	
	function createPlayerElements() {
        const fragment = document.createDocumentFragment();
        playerContainer = document.createElement("div"); playerContainer.id = PLAYER_ELEMENT_ID; fragment.appendChild(playerContainer);
        
        const mainPlayerArea = document.createElement("div");
        mainPlayerArea.id = "player-main-area";
        playerContainer.appendChild(mainPlayerArea);

        mainContentWrapper = document.createElement("div"); mainContentWrapper.id = PLAYER_MAIN_CONTENT_WRAPPER_ID; mainPlayerArea.appendChild(mainContentWrapper);

        const displayBox = document.createElement("div"); displayBox.id = DISPLAY_BOX_ID;
        coverElement = document.createElement("img"); coverElement.id = COVER_ID; coverElement.alt = "Album cover"; coverElement.src = ""; displayBox.appendChild(coverElement);
        mainContentWrapper.appendChild(displayBox);

        const rightPanel = document.createElement("div");
        rightPanel.id = PLAYER_RIGHT_PANEL_ID;
        mainContentWrapper.appendChild(rightPanel);

        playlistSelectorContainer = document.createElement("div");
        playlistSelectorContainer.id = PLAYLIST_SELECTOR_CONTAINER_ID;
        const playlistLabel = document.createElement("label"); playlistLabel.htmlFor = PLAYLIST_SELECTOR_ID; playlistLabel.textContent = "Select playlist:"; playlistSelectorContainer.appendChild(playlistLabel);
        playlistSelectorElement = document.createElement("select"); playlistSelectorElement.id = PLAYLIST_SELECTOR_ID; playlistSelectorElement.title = "Select playlist"; playlistSelectorContainer.appendChild(playlistSelectorElement);
        rightPanel.appendChild(playlistSelectorContainer);

        const infoContainer = document.createElement("div"); infoContainer.id = INFO_CONTAINER_ID;
        const songInfo = document.createElement("div"); songInfo.id = SONG_INFO_ID;
        const titleLineWrapper = document.createElement("div"); titleLineWrapper.className = TITLE_LINE_WRAPPER_CLASS;
        titleElement = document.createElement("h3"); titleElement.id = TITLE_ID; titleElement.textContent = "Loading..."; titleLineWrapper.appendChild(titleElement);
        youtubeLinkElement = document.createElement("a"); youtubeLinkElement.id = YOUTUBE_LINK_ID; youtubeLinkElement.target = "_blank"; youtubeLinkElement.rel = "noopener noreferrer"; youtubeLinkElement.title = "Watch on YouTube"; youtubeLinkElement.classList.add('hidden');
        const ytIcon = document.createElement("img"); ytIcon.src = ICON_YOUTUBE; ytIcon.alt = "YouTube"; youtubeLinkElement.appendChild(ytIcon); titleLineWrapper.appendChild(youtubeLinkElement);
        songInfo.appendChild(titleLineWrapper);
        artistElement = document.createElement("p"); artistElement.id = ARTIST_ID; artistElement.textContent = ""; songInfo.appendChild(artistElement);
        infoContainer.appendChild(songInfo);
        rightPanel.appendChild(infoContainer);

        const progressBarContainer = document.createElement("div"); progressBarContainer.id = PROGRESS_BAR_CONTAINER_ID;
        currentTimeElement = document.createElement("span"); currentTimeElement.id = CURRENT_TIME_ID; currentTimeElement.textContent = "0:00"; progressBarContainer.appendChild(currentTimeElement);
        progressBar = document.createElement("input"); progressBar.type = "range"; progressBar.id = PROGRESS_BAR_ID; progressBar.value = "0"; progressBar.min = "0"; progressBar.max = "100"; progressBar.step = "0.1"; progressBar.title="Seek"; progressBar.style.setProperty('--progress-percent', '0%'); progressBarContainer.appendChild(progressBar);
        durationElement = document.createElement("span"); durationElement.id = DURATION_ID; durationElement.textContent = "--:--"; progressBarContainer.appendChild(durationElement);
        rightPanel.appendChild(progressBarContainer);
        
        const controlsContainer = document.createElement("div"); controlsContainer.id = CONTROLS_CONTAINER_ID;
        const controls = document.createElement("div"); controls.id = CONTROLS_ID;
        
        shuffleButtonElement = document.createElement("button"); shuffleButtonElement.id = SHUFFLE_BUTTON_ID; shuffleButtonElement.classList.add(PLAYER_CONTROL_BUTTON_CLASS, 'player-shuffle-button');
        const shuffleIcon = document.createElement("img"); shuffleIcon.alt = ""; shuffleIcon.src = ICON_SHUFFLE_OFF; shuffleButtonElement.appendChild(shuffleIcon); controls.appendChild(shuffleButtonElement);
        
        prevButtonElement = document.createElement("button"); prevButtonElement.id = PREV_BUTTON_ID; prevButtonElement.classList.add(PLAYER_CONTROL_BUTTON_CLASS); prevButtonElement.setAttribute('aria-label', 'Previous song'); prevButtonElement.title = 'Previous song';
        const prevIcon = document.createElement("img"); prevIcon.src = ICON_PREV; prevIcon.alt = ""; prevButtonElement.appendChild(prevIcon); controls.appendChild(prevButtonElement);
        
        playPauseButton = document.createElement("button"); playPauseButton.id = PLAY_PAUSE_BUTTON_ID; playPauseButton.classList.add(PLAYER_CONTROL_BUTTON_CLASS);
        const playPauseIcon = document.createElement("img"); playPauseIcon.alt = ""; playPauseIcon.src = ICON_PLAY; playPauseButton.appendChild(playPauseIcon); controls.appendChild(playPauseButton);
        
        nextButtonElement = document.createElement("button"); nextButtonElement.id = NEXT_BUTTON_ID; nextButtonElement.classList.add(PLAYER_CONTROL_BUTTON_CLASS); nextButtonElement.setAttribute('aria-label', 'Next song'); nextButtonElement.title = 'Next song';
        const nextIcon = document.createElement("img"); nextIcon.src = ICON_NEXT; nextIcon.alt = ""; nextButtonElement.appendChild(nextIcon); controls.appendChild(nextButtonElement);

        repeatButtonElement = document.createElement("button"); repeatButtonElement.id = REPEAT_BUTTON_ID; repeatButtonElement.classList.add(PLAYER_CONTROL_BUTTON_CLASS, 'player-repeat-button');
        const repeatIcon = document.createElement("img"); repeatIcon.alt = ""; repeatIcon.src = ICON_REPEAT_NONE; repeatButtonElement.appendChild(repeatIcon); controls.appendChild(repeatButtonElement);
        
        controlsContainer.appendChild(controls);

        volumeContainer = document.createElement("div"); volumeContainer.id = VOLUME_CONTAINER_ID;
        volumeIconElement = document.createElement("img"); volumeIconElement.id = VOLUME_ICON_ID; volumeIconElement.alt = "Mute"; volumeIconElement.title = "Mute/Unmute"; volumeIconElement.style.cursor = 'pointer'; volumeIconElement.src = ICON_VOLUME; volumeContainer.appendChild(volumeIconElement);
        volumePercentageElement = document.createElement("span"); volumePercentageElement.id = VOLUME_PERCENTAGE_ID; volumePercentageElement.textContent = "50%"; volumeContainer.appendChild(volumePercentageElement);
        volumeSlider = document.createElement("input"); volumeSlider.type = "range"; volumeSlider.id = VOLUME_SLIDER_ID; volumeSlider.min = 0; volumeSlider.max = 1; volumeSlider.step = 0.01; volumeSlider.value = 0.5; volumeSlider.title = "Adjust volume"; volumeContainer.appendChild(volumeSlider);
        controlsContainer.appendChild(volumeContainer);

        rightPanel.appendChild(controlsContainer);

        queueContainerElement = document.createElement("div"); queueContainerElement.id = QUEUE_CONTAINER_ID;
        queueTitleElement = document.createElement("h4"); queueTitleElement.id = QUEUE_TITLE_ID;
        queueTitleElement.innerHTML = `Up next <span id="${QUEUE_TOGGLE_ICON_ID}">${isQueueSectionExpanded ? "▼" : "▸"}</span>`;
        queueContainerElement.appendChild(queueTitleElement);
        queueListElement = document.createElement("ul"); queueListElement.id = QUEUE_LIST_ID; queueContainerElement.appendChild(queueListElement);
        mainPlayerArea.appendChild(queueContainerElement);

        const youtubePlayerDiv = document.createElement("div"); youtubePlayerDiv.id = YOUTUBE_PLAYER_DIV_ID; fragment.appendChild(youtubePlayerDiv);
        return fragment;
    }

    function loadYouTubeAPI() {
        return new Promise((resolve, reject) => {
            if (typeof YT !== 'undefined' && typeof YT.Player !== 'undefined') { resolve(); return; }
            window.onYouTubeIframeAPIReady = () => { resolve(); };
            const existingScript = document.querySelector('script[src="https://www.youtube.com/iframe_api"]');
            if (existingScript) return;
            const tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api";
            tag.onerror = (err) => { console.error("Failed to load YouTube API script:", err); delete window.onYouTubeIframeAPIReady; reject(err); };
            const firstScriptTag = document.getElementsByTagName('script')[0];
            if (firstScriptTag && firstScriptTag.parentNode) firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            else document.head.appendChild(tag);
        });
    }

    function bindUIEventListeners() {
        if (!playPauseButton || !nextButtonElement || !prevButtonElement || !repeatButtonElement || !shuffleButtonElement ||
            !progressBar || !volumeIconElement || !volumeSlider || !playlistSelectorElement || !queueTitleElement) {
            console.error("Failed to bind listeners: Core UI elements missing.");
            return;
        }

        playPauseButton.addEventListener("click", togglePlayPause);
        nextButtonElement.addEventListener("click", () => {
            if (!hasUserInitiatedPlayback) {
                if (playlist.isEmpty()) return;
                hasUserInitiatedPlayback = true;
                playlist?.playNext();
                loadCurrentSong(true);
            } else {
                const wasPlaying = playerReady && ytPlayer?.getPlayerState() === YT.PlayerState.PLAYING;
                const shouldAutoplay = wasPlaying || repeatMode === 'all' || (playlist.currentSongIndex !== playlist.getSongs().length - 1);
                playlist?.playNext();
                loadCurrentSong(shouldAutoplay);
            }
        });
        prevButtonElement.addEventListener("click", () => {
            if (!hasUserInitiatedPlayback) {
                 if (playlist.isEmpty()) return;
                hasUserInitiatedPlayback = true;
                playlist?.playPrevious();
                loadCurrentSong(true);
            } else {
                const wasPlaying = playerReady && ytPlayer?.getPlayerState() === YT.PlayerState.PLAYING;
                const shouldAutoplay = wasPlaying || repeatMode === 'all';
                playlist?.playPrevious();
                loadCurrentSong(shouldAutoplay);
            }
        });
        repeatButtonElement.addEventListener("click", toggleRepeatMode);
        shuffleButtonElement.addEventListener("click", toggleShuffleMode);
        volumeIconElement.addEventListener("click", toggleMute);
        queueTitleElement.addEventListener('click', toggleQueueExpansion);

        progressBar.addEventListener("mousedown", () => { isSeeking = true; stopRafUpdater(); });
        progressBar.addEventListener("touchstart", () => { isSeeking = true; stopRafUpdater(); }, { passive: true });
        progressBar.addEventListener("input", () => {
            if (!isSeeking || !hasUserInitiatedPlayback) return;
            const percentage = progressBar.value;
            progressBar.style.setProperty('--progress-percent', `${percentage}%`);
            if (playerReady && ytPlayer && typeof ytPlayer.getDuration === 'function' && currentTimeElement) {
                const duration = ytPlayer.getDuration();
                if (duration && isFinite(duration)) {
                    currentTimeElement.textContent = formatTime((percentage / 100) * duration);
                }
            }
        });
        progressBar.addEventListener("change", () => {
            if (!hasUserInitiatedPlayback) {
                 isSeeking = false; return;
            }
            if (!playerReady || !ytPlayer || typeof ytPlayer.getDuration !== 'function' || typeof ytPlayer.seekTo !== 'function') {
                 isSeeking = false; return;
            }
            const duration = ytPlayer.getDuration();
            if (!duration || !isFinite(duration) || duration <= 0) { isSeeking = false; return; }
            const seekTime = (progressBar.value / 100) * duration;
            ytPlayer.seekTo(seekTime, true);
            if (currentTimeElement) currentTimeElement.textContent = formatTime(seekTime);
            isSeeking = false;
            const state = ytPlayer.getPlayerState();
            if (state === YT.PlayerState.PLAYING) startRafUpdater();
            else stopRafUpdater();
        });
        const handleSeekEnd = () => { if (isSeeking) progressBar.dispatchEvent(new Event('change')); };
        progressBar.addEventListener("mouseup", handleSeekEnd);
        progressBar.addEventListener("touchend", handleSeekEnd);
		
		volumeSlider.addEventListener("input", () => {
			setVolumeFromSlider(true);
			updateVolumeIcon();
		});
        
        playlistSelectorElement.addEventListener("change", (event) => {
            const newIndex = parseInt(event.target.value, 10);
            if (!isNaN(newIndex)) {
                if (!hasUserInitiatedPlayback) {
                    loadNewPlaylistByIndex(newIndex, false);
                } else {
                    const wasPlaying = playerReady && ytPlayer && typeof ytPlayer.getPlayerState === 'function' && ytPlayer.getPlayerState() === YT.PlayerState.PLAYING;
                    loadNewPlaylistByIndex(newIndex, wasPlaying);
                }
            }
        });

campaignTrail_temp.achievements = {
    // Baseline Achievements
    "A Strong and Stable Victory" : {
    "image" : "https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/AcheivementStrongAndStableVictory.png",
    "description" : "As Theresa May, win at least 400 seats. (normal or harder)",
    "cannotBeCheated" : true
    },
	"Weak and Wobbly" : {
    "image" : "https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/AchievementWeakandWobbly.png",
    "description" : "Lose your Maidenhead seat as Theresa May. (any difficulty)",
    "cannotBeCheated" : true
    },
	"Confidence and Supply" : {
    "image" : "https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/AchievementConfidenceAndSupply.png",
    "description" : "Get the real world ending by forming a confidence and supply agreement with the DUP. (normal or harder)",
    "cannotBeCheated" : true
    },
	"I, Maybot" : {
    "image" : "https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/AchievementI%2CMaybot.png",
    "description" : "Get a majority as Theresa May with a terrible campaign. (normal or harder)",
    "cannotBeCheated" : true
    },
	"Oh Jeremy Corbyn" : {
    "image" : "https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/AchievementOhJeremyCorbyn.png",
    "description" : "Get a majority as Jeremy Corbyn. (normal or harder)",
    "cannotBeCheated" : true
    },
	"Oh, Jeremy Corbyn" : {
    "image" : "https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/AchievementOh%2CJeremyCorbyn.png",
    "description" : "Lead Labour to a historic defeat not seen for almost 90 years. (normal or easier)",
    "cannotBeCheated" : true
    },
	"For the Many, Not The Few" : {
    "image" : "https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/AchievementForTheMany%2CNotTheFew.png",
    "description" : "Form a Labour government despite the party turning on you. (normal or harder)",
    "cannotBeCheated" : true
    },
	"No confidence, no problem" : {
    "image" : "https://file.garden/Zmvf_kGfBgouz-z5/2017%20UK%20images/AchievementNoConfidence%2CNoProblem.png",
    "description" : "Form a Labour government despite the party declaring a no-confidence vote. (normal or harder)",
    "cannotBeCheated" : true
    }
}
